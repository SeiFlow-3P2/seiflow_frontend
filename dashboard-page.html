<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <link rel="stylesheet" href="./styles/dashboard-page.css">
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  <link rel="stylesheet" href="./styles/profile-modal.css">
</head>

<body>
  <div class="dashboard-container">
    <header class="dashboard-header">
      <div class="header-content">
        <div class="header-left">
          <button class="mobile-menu-button" aria-label="Открыть меню">
            <i data-lucide="menu" aria-hidden="true"></i>
          </button>
          <div class="logo">SeiFlow</div>
        </div>
        <div class="header-right">
          <button class="notification-button" aria-label="Уведомления">
            <i data-lucide="bell" aria-hidden="true"></i>
            <span class="notification-badge"></span>
          </button>
          <div class="user-dropdown">
            <button class="user-button" aria-label="Открыть меню пользователя">
              <div class="user-avatar">А</div>
              <span class="user-name">Александр</span>
              <i data-lucide="chevron-down" aria-hidden="true"></i>
            </button>
            <div class="dropdown-menu">
              <a href="#" class="dropdown-item" id="profile">
                <i data-lucide="user" class="dropdown-icon" aria-hidden="true"></i>
                Профиль
              </a>
              <a href="#" class="dropdown-item" id="theme-toggle">
                <i data-lucide="moon" class="dropdown-icon" id="theme-icon" aria-hidden="true"></i>
                Тема
              </a>
              <a href="#" class="dropdown-item" id="logout-button">
                <i data-lucide="log-out" class="dropdown-icon" aria-hidden="true"></i>
                Выйти          
              </a>
            </div>
          </div>
        </div>
      </div>
    </header>

    <div class="dashboard-content">
      <aside class="desktop-sidebar">
        <nav class="sidebar-nav">
          <a href="/index.html" class="sidebar-link ">
            <i data-lucide="home" class="sidebar-icon" aria-hidden="true"></i>
            Главная
          </a>
          <a href="/dashboard-page.html" class="sidebar-link active">
            <i data-lucide="trello" class="sidebar-icon" aria-hidden="true"></i>
            Мои доски
          </a>
          <a href="/calendar.html" class="sidebar-link">
            <i data-lucide="calendar" class="sidebar-icon" aria-hidden="true"></i>
            Календарь
          </a>
          <a href="#" class="sidebar-link">
            <i data-lucide="file-text" class="sidebar-icon" aria-hidden="true"></i>
            Контент
          </a>
        </nav>
        <div class="recent-boards">
          <div class="sidebar-section-title">Недавние доски</div>
          <div class="board-links">
            <a href="#" class="board-link">
              <i data-lucide="book-open" class="board-icon yellow-icon" aria-hidden="true"></i>
              Изучение испанского языка
            </a>
            <a href="#" class="board-link">
              <i data-lucide="heart" class="board-icon red-icon" aria-hidden="true"></i>
              Фитнес-челлендж
            </a>
            <a href="#" class="board-link">
              <i data-lucide="bar-chart-2" class="board-icon green-icon" aria-hidden="true"></i>
              Личные финансы
            </a>
          </div>
        </div>
      </aside>

      <aside class="mobile-sidebar">
        <nav class="sidebar-nav">
          <a href="#" class="sidebar-link active">
            <i data-lucide="home" class="sidebar-icon" aria-hidden="true"></i>
            Главная
          </a>
          <a href="#" class="sidebar-link">
            <i data-lucide="trello" class="sidebar-icon" aria-hidden="true"></i>
            Мои доски
          </a>
          <a href="#" class="sidebar-link">
            <i data-lucide="calendar" class="sidebar-icon" aria-hidden="true"></i>
            Календарь
          </a>
          <a href="#" class="sidebar-link">
            <i data-lucide="file-text" class="sidebar-icon" aria-hidden="true"></i>
            Контент
          </a>
        </nav>
        <div class="recent-boards">
          <div class="sidebar-section-title">Недавние доски</div>
          <div class="board-links">
            <a href="#" class="board-link">
              <i data-lucide="book-open" class="board-icon yellow-icon" aria-hidden="true"></i>
              Изучение испанского языка
            </a>
            <a href="#" class="board-link">
              <i data-lucide="heart" class="board-icon red-icon" aria-hidden="true"></i>
              Фитнес-челлендж
            </a>
            <a href="#" class="board-link">
              <i data-lucide="bar-chart-2" class="board-icon green-icon" aria-hidden="true"></i>
              Личные финансы
            </a>
          </div>
        </div>
      </aside>

      <main class="main-content">
        <div class="content-header">
          <div class="header-info">
            <h1>Мои доски</h1>
            <p>Управляйте своими персонализированными досками</p>
          </div>
          <div class="header-actions">
            <div class="view-toggle">
              <button class="view-button" data-view="grid" aria-label="Вид сеткой">
                <i data-lucide="grid" aria-hidden="true"></i>
              </button>
              <button class="view-button" data-view="list" aria-label="Вид списком">
                <i data-lucide="list" aria-hidden="true"></i>
              </button>
            </div>
            <button class="new-board-button" id="newBoardButton">
              <i data-lucide="plus" aria-hidden="true"></i>
              Новая доска
            </button>
          </div>
        </div>

        <div class="category-buttons category-filter">
          <button class="category-button filter-category-button active" aria-pressed="true">Все доски</button>
          <button class="category-button filter-category-button">Обучение</button>
          <button class="category-button filter-category-button">Здоровье</button>
          <button class="category-button filter-category-button">Финансы</button>
          <button class="category-button filter-category-button">Личное</button>
        </div>

        <div class="boards-grid" id="boardsGrid">
          <div class="new-board-card" id="newBoardCard">
            <div class="new-board-icon">
              <i data-lucide="plus" aria-hidden="true"></i>
            </div>
            <h3>Создать новую доску</h3>
            <p>Добавьте персонализированную доску для любых целей</p>
          </div>
        </div>

      </main>
    </div>

    <div class="modal" id="newBoardModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Создание новой доски</h2>
          <button class="modal-close" id="closeModal">×</button>
        </div>
        <div class="modal-body">
          <form id="newBoardForm">
            <div class="form-group">
              <label for="boardTitle">Название доски:</label>
              <input type="text" id="boardTitle" name="boardTitle" required>
            </div>
            <div class="form-group">
              <label for="boardDescription">Описание:</label>
              <textarea id="boardDescription" name="boardDescription"></textarea>
            </div>
            <div class="form-group">
              <label>Категория:</label>
              <div class="category-buttons">
                <input type="hidden" id="boardCategory" name="boardCategory" value="learning">
                <button type="button" class="modal-category-button active" data-value="learning">Обучение</button>
                <button type="button" class="modal-category-button" data-value="health">Здоровье</button>
                <button type="button" class="modal-category-button" data-value="finance">Финансы</button>
                <button type="button" class="modal-category-button" data-value="personal">Личное</button>
              </div>
            </div>
            <div class="form-group">
              <label>Методология:</label>
              <div class="methodology-buttons">
                <input type="hidden" id="boardMethodology" name="boardMethodology" value="none">
                <button type="button" class="methodology-button active" data-value="none">Без методологии</button>
                <button type="button" class="methodology-button" data-value="scrum">Scrum</button>
              </div>
            </div>
            <div class="modal-actions">
              <button type="submit" class="modal-submit">Создать</button>
              <button type="button" class="modal-cancel" id="cancelModal">Отмена</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <footer class="footer">
      <div class="footer-container">
        <div class="footer-grid">
          <div class="footer-about">
            <div class="footer-logo">SeiFlow</div>
            <p class="footer-description">Интеллектуальная платформа для персонализированной организации жизни</p>
          </div>
          <div>
            <h4 class="footer-links-title">Платформа</h4>
            <ul class="footer-links-list">
              <li><a href="#" class="footer-link">Возможности</a></li>
              <li><a href="#" class="footer-link">Сервисы</a></li>
              <li><a href="#" class="footer-link">Доски</a></li>
              <li><a href="#" class="footer-link">Интеграции</a></li>
            </ul>
          </div>
          <div>
            <h4 class="footer-links-title">Компания</h4>
            <ul class="footer-links-list">
              <li><a href="#" class="footer-link">О нас</a></li>
              <li><a href="#" class="footer-link">Блог</a></li>
              <li><a href="#" class="footer-link">Карьера</a></li>
              <li><a href="#" class="footer-link">Контакты</a></li>
            </ul>
          </div>
          <div>
            <h4 class="footer-links-title">Правовая информация</h4>
            <ul class="footer-links-list">
              <li><a href="#" class="footer-link">Условия использования</a></li>
              <li><a href="#" class="footer-link">Политика конфиденциальности</a></li>
              <li><a href="#" class="footer-link">Cookies</a></li>
            </ul>
          </div>
        </div>
        <div class="footer-copyright">© 2025 SeiFlow. Все права защищены.</div>
      </div>
    </footer>
  </div>
  <div class="modal-overlay hidden" id="profileModal">
    <div class="profile-container">
      <div class="profile-header">
        <div class="avatar-container">
          <div class="avatar">
            <img id="avatarImage" src="" alt="Аватар" style="display: none;">
            <i id="avatarIcon" data-lucide="user" class="avatar-icon"></i>
          </div>
          <button id="avatarActionButton" class="avatar-action-button">
            <i id="actionIcon" data-lucide="plus"></i>
          </button>
          <input type="file" id="fileInput" accept="image/*" style="display: none;">
        </div>
        <div class="header-buttons">
          <button class="settings-button">
            <i data-lucide="settings"></i>
          </button>
          <button class="logout-button">
            <i data-lucide="log-out"></i>
          </button>
        </div>
      </div>
      <div class="profile-info" style="display: block;" class="view-mode">
        <h2 class="user-name">Александр Петров</h2>
        <p class="user-bio">Разработчик программного обеспечения</p>
        <div class="user-details">
          <div class="detail-item">
            <i data-lucide="mail" class="detail-icon"></i>
            <span class="detail-text">[email protected]</span>
          </div>
          <div class="detail-item">
            <i data-lucide="map-pin" class="detail-icon"></i>
            <span class="detail-text">Москва, Россия</span>
          </div>
        </div>
        <div class="stats-container">
          <div class="stat-item">
            <span class="stat-number">12</span>
            <span class="stat-label">Проектов</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">3.4K</span>
            <span class="stat-label">Подписчиков</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">257</span>
            <span class="stat-label">Подписок</span>
          </div>
        </div>
      </div>
      <div class="edit-form" style="display: none;">
        <div>
          <label for="nameInput" class="input-label">Имя</label>
          <input type="text" id="nameInput" class="input-field" value="Александр Петров">
        </div>
        <div>
          <label for="bioInput" class="input-label">О себе</label>
          <textarea id="bioInput" class="textarea-field">Разработчик программного обеспечения</textarea>
        </div>
        <div class="form-buttons">
          <button class="cancel-button">Отмена</button>
          <button class="save-button">Сохранить</button>
        </div>
      </div>
    </div>
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // Восстанавливаем состояние фильтров
      if (window.utils && window.utils.restoreFilterState) {
        const activeCategory = window.utils.restoreFilterState();

        // Обновляем видимость карточек
        if (window.updateBoardVisibility) {
          window.updateBoardVisibility();
        }
      }
    });
  </script>
<script type="module">
  import { logout } from "./scripts/auth.js"; // Уточнён путь
  document.addEventListener("DOMContentLoaded", () => {
    console.log("Скрипт dashboard-page загружен");
    const profileModal = document.getElementById("profile-modal");
    try {
      if (window.utils && window.utils.restoreFilterState) {
        console.log("Восстановление фильтров...");
        const activeCategory = window.utils.restoreFilterState();
        if (window.updateBoardVisibility) {
          window.updateBoardVisibility();
        }
      }
      const profileButton = document.querySelector(".dropdown-item[href='#profile']");
      if (profileButton) {
        console.log("Кнопка Профиль найдена");
        profileButton.addEventListener("click", (e) => {
          e.preventDefault();
          console.log("Нажата кнопка Профиль");
          profileModal.style.display = "flex";
          profileModalOverlay.style.display = "block";
          profileModal.querySelector(".user-name").focus();
        });
      } else {
        console.error("Кнопка Профиль не найдена");
      }
      const logoutButton = document.getElementById("logout-button");
      if (logoutButton) {
        console.log("Кнопка Выйти найдена");
        logoutButton.addEventListener("click", async (e) => {
          e.preventDefault();
          console.log("Нажата кнопка Выйти");
          try {
            await logout();
          } catch (err) {
            console.error("Ошибка при выходе:", err.message);
            // Принудительный переход на index.html
            localStorage.removeItem("accessToken");
            localStorage.removeItem("refreshToken");
            window.location.href = "index.html";
          }
        });
      } else {
        console.error("Кнопка logout-button не найдена");
      }
      lucide.createIcons();
    } catch (err) {
      console.error("Ошибка в скрипте dashboard-page:", err.message);
    }
  });
</script>
  <script src="./scripts/menu.js"></script>
  <script src="./scripts/theme-switcher.js"></script>
  <script src="./scripts/view-mode.js"></script>
  <script src="./scripts/filters.js"></script>
  <script src="./scripts/modal.js"></script>
  <script src="./scripts/boardActions.js"></script>
  <script src="./scripts/boardNavigation.js"></script>
  <script src="./scripts/syncDashboard.js"></script>
  <script src="./scripts/utils.js"></script>
  <script src="./scripts/profile-modal.js"></script>
</body>

</html>
